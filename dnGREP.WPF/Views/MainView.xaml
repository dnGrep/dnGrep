<Window x:Class="dnGREP.WPF.MainForm"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:my="clr-namespace:dnGREP.WPF"
xmlns:Controls="clr-namespace:dnGREP.WPF.UserControls"
xmlns:sys="clr-namespace:System;assembly=mscorlib"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
mc:Ignorable="d"
Title="{Binding WindowTitle}" MinWidth="785" MinHeight="460" WindowState="Normal" d:DesignWidth="900"
Icon="/dnGREP;component/nGREP.ico" 
Closing="MainForm_Closing" Loaded="Window_Loaded" Activated="Window_Activated" StateChanged="Window_StateChanged"
SnapsToDevicePixels="True" ResizeMode="CanResizeWithGrip" AllowDrop="False"
my:DiginesisHelpProvider.HelpKeyword="Search-Window" my:DiginesisHelpProvider.HelpNavigator="Topic" my:DiginesisHelpProvider.ShowHelp="True" 
WindowStartupLocation="Manual" FocusManager.FocusedElement="{Binding ElementName=tbSearchFor}" Width="800">
    <Window.Resources>
        <my:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <my:TotalValueConverter x:Key="TotalValueConverter" />
        <my:EnumBooleanConverter x:Key="ebc" />
        <my:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" TrueValue="Visible" FalseValue="Collapsed"/>
        <my:BoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" TrueValue="Collapsed" FalseValue="Visible" />
    </Window.Resources>
    <Window.Background>
        <StaticResource ResourceKey="GradientBackground"/>
    </Window.Background>
    <Window.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding CloseCommand}"/>
        <KeyBinding Key="F" Modifiers="Alt" Command="{Binding ToggleFileOptionsCommand}" />
    </Window.InputBindings>

    <DockPanel ManipulationBoundaryFeedback="ManipulationBoundaryFeedbackHandler">
        <DockPanel DockPanel.Dock="Top" Margin="5,5,5,-2">
            <TextBlock DockPanel.Dock="Left" FontSize="16" FontWeight="DemiBold" Text="dnGrep"/>
            <Menu x:Name="mnuMainMenu" Background="Transparent" HorizontalAlignment="Right">
                <Menu.Resources>
                    <Style TargetType="MenuItem">
                        <Setter Property="Height" Value="{Binding ActualHeight, ElementName=mnuMainMenu}"/>
                    </Style>
                </Menu.Resources>
                <MenuItem Header="_Undo" Command="{Binding UndoCommand}" TabIndex="0"/>
                <MenuItem Header="_Options..." Command="{Binding OptionsCommand}"  TabIndex="1"/>
                <MenuItem Header="_Bookmarks..." Command="{Binding BookmarkOpenCommand}" TabIndex="2"/>
                <MenuItem Header="_About" TabIndex="3">
                    <MenuItem Command="{Binding HelpCommand}" Header="_Help"/>
                    <MenuItem Command="{Binding AboutCommand}" Header="_About dnGrep..."/>
                </MenuItem>
            </Menu>
        </DockPanel>
        <StatusBar ClipToBounds="False" DockPanel.Dock="Bottom">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <ProgressBar Height="18" IsIndeterminate="{Binding IsOperationInProgress}" Width="150" />
                    <TextBlock Text="{Binding StatusMessage}" Margin="3,0" />
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal" Visibility="{Binding IsSaveInProgress, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ProgressBar Height="18" IsIndeterminate="true" Width="150" />
                    <TextBlock Text="Saving results to file..." Margin="3,0,12,0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
        <DockPanel LastChildFill="True">
            <GroupBox DockPanel.Dock="Top" Header="Search in">
                <DockPanel VerticalAlignment="Stretch" Height="Auto">
                    <Button DockPanel.Dock="Right" Command="{Binding BrowseCommand}" ToolTip="Browse for folder or files" TabIndex="11" Content="..." Width="24" VerticalAlignment="Center"/>
                    <ComboBox DockPanel.Dock="Right" x:Name="SearchText" TabIndex="10" Text="{Binding FileOrFolderPath}" ItemsSource="{Binding FastPathBookmarks}" IsEditable="True" Margin="0,0,5,0" VerticalContentAlignment="Center" VerticalAlignment="Center" />
                </DockPanel>
            </GroupBox>
            <GroupBox Header="Search" DockPanel.Dock="Top">
                <DockPanel VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Height="Auto">
                    <DockPanel DockPanel.Dock="Top" Margin="0,0,0,3">
                        <Button Content="Test Regex" Command="{Binding TestCommand}" TabIndex="25" Width="72" DockPanel.Dock="Right" VerticalAlignment="Center"/>
                        <CheckBox ToolTip="{Binding IsBookmarkedTooltip}" Template="{DynamicResource FavsMetroButtonTemplate}" IsChecked="{Binding IsBookmarked}" Command="{Binding BookmarkAddCommand}" DockPanel.Dock="Right" TabIndex="24" Width="22" Height="22" Margin="0,0,5,0"/>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" Margin="75,0,0,0">
                            <RadioButton Content="_Regex" GroupName="SearchRegex" IsChecked="{Binding TypeOfSearch, ConverterParameter=Regex, Converter={StaticResource ebc}}" ToolTip="Regular expression search" TabIndex="20" Margin="0,0,5,0" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                            <RadioButton Content="_XPath" GroupName="SearchXPath" IsChecked="{Binding TypeOfSearch, ConverterParameter=XPath, Converter={StaticResource ebc}}" ToolTip="XPath search (XML documents only)" TabIndex="21" Margin="0,0,5,0" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                            <RadioButton Content="_Text" GroupName="SearchText" IsChecked="{Binding TypeOfSearch, ConverterParameter=PlainText, Converter={StaticResource ebc}}" ToolTip="Plain text search" TabIndex="22" Margin="0,0,5,0" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                            <RadioButton Content="_Phonetic" GroupName="SearchSoundex" IsChecked="{Binding TypeOfSearch, ConverterParameter=Soundex, Converter={StaticResource ebc}}" ToolTip="Phonetic search" TabIndex="23" Margin="0,0,5,0" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                        </StackPanel>
                        <Label Content="{Binding ValidationMessage}" HorizontalAlignment="Center"/>
                    </DockPanel>
                    <StackPanel Margin="0,3" Visibility="{Binding OptionsOnMainPanel, Converter={StaticResource BoolToVisibilityConverter}}" DockPanel.Dock="Bottom">
                        <DockPanel DockPanel.Dock="Top" Margin="0,0,0,3">
                            <WrapPanel Orientation="Horizontal" Margin="75,0,0,0">
                                <CheckBox Margin="0,3,5,3" IsChecked="{Binding CaseSensitive}" IsEnabled="{Binding IsCaseSensitiveEnabled}" TabIndex="50" Content="C_ase sensitive"/>
                                <CheckBox Margin="0,3,5,3" IsChecked="{Binding WholeWord}" IsEnabled="{Binding IsWholeWordEnabled}" TabIndex="51" Content="_Whole word"/>
                                <CheckBox Margin="0,3,5,3" IsChecked="{Binding Multiline}" IsEnabled="{Binding IsMultilineEnabled}" TabIndex="52" Content="_Multiline"/>
                                <CheckBox Margin="0,3,5,3" IsChecked="{Binding Singleline}" IsEnabled="{Binding IsSinglelineEnabled}" TabIndex="53" Content="_Dot matches newline"/>
                            </WrapPanel>
                            <ComboBox DockPanel.Dock="Right" Width="240" x:Name="cbEncoding" TabIndex="53" DisplayMemberPath="Key" SelectedValuePath="Value" ItemsSource="{Binding Encodings}" SelectedValue="{Binding CodePage}" Initialized="cbEncoding_Initialized" Height="22" Margin="5,0,0,0"/>
                            <TextBlock Text="Encoding:" VerticalAlignment="Center" DockPanel.Dock="Right" HorizontalAlignment="Right"/>
                        </DockPanel>
                        <Expander Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="5" IsExpanded="{Binding IsFiltersExpanded}">
                            <Expander.Header>
                                <StackPanel Orientation="Horizontal" Margin="0,3">
                                    <TextBlock x:Name="fileOptions" TextWrapping="NoWrap" Text="Search Options"/>
                                    <TextBlock Margin="12,0,0,0" Text="{Binding FileFiltersSummary}" Foreground="DimGray" MaxWidth="{Binding Path=ActualWidth, ElementName=SearchText}" TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                            </Expander.Header>
                            <GroupBox>
                                <DockPanel VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Height="Auto">
                                    <!-- left / middle -->
                                    <StackPanel x:Name="stckLeftSearchOptions" Orientation="Vertical" VerticalAlignment="Top" Margin="0,0,10,0" Width="430">
                                        <Grid Margin="3,5,0,0" Width="767">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="16*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="27*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="19*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="27*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="16*" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200"/>
                                                <ColumnDefinition Width="15"/>
                                                <ColumnDefinition Width="215"/>
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <!-- left -->
                                            <RadioButton GroupName="SizeFilter" Name="rbFilterAllSizes" TabIndex="61" Content="All sizes" IsChecked="{Binding Path=UseFileSizeFilter, Converter={StaticResource ebc}, ConverterParameter=No}" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                                            <StackPanel Orientation="Horizontal" Grid.Row="2" VerticalAlignment="Center">
                                                <RadioButton GroupName="SizeFilter" VerticalAlignment="Center" Name="rbFilterSpecificSize" TabIndex="62" Content="Size is" IsChecked="{Binding Path=UseFileSizeFilter, Converter={StaticResource ebc}, ConverterParameter=Yes}" VerticalContentAlignment="Center"/>
                                                <TextBox Width="48" Name="tbFileSizeFrom" IsEnabled="{Binding Path=IsSizeFilterSet}" TabIndex="63" GotFocus="TextBoxFocus" PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBoxPasting" Margin="15,0,0,0" Height="22" Panel.ZIndex="2" VerticalContentAlignment="Center" VerticalAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="SizeFrom" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <ExceptionValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <TextBlock Margin="5,0,0,0" VerticalAlignment="Center">to</TextBlock>
                                                <TextBox Width="48" Name="tbFileSizeTo" IsEnabled="{Binding Path=IsSizeFilterSet}" TabIndex="64" GotFocus="TextBoxFocus" PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBoxPasting" Margin="5,0,0,0" Height="22" VerticalContentAlignment="Center" VerticalAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="SizeTo" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <ExceptionValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <TextBlock VerticalAlignment="Center" Margin="5,0,0,0">KB</TextBlock>
                                            </StackPanel>
                                            <CheckBox IsChecked="{Binding Path=IncludeSubfolder}" Name="cbIncludeSubfolders" TabIndex="65" Content="Include subfolders" Grid.Row="4" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                                            <CheckBox IsChecked="{Binding Path=IncludeHidden}" Name="cbIncludeHiddenFolders" TabIndex="66" Content="Include hidden items" Grid.Row="6" VerticalAlignment="Center" VerticalContentAlignment="Center"/>
                                            <CheckBox IsChecked="{Binding Path=IncludeBinary}" Name="cbIncludeBinary" TabIndex="67" Content="Include binary files" Grid.Row="8" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                                            <!-- middle -->
                                            <StackPanel Orientation="Horizontal" Grid.Column="2">
                                                <RadioButton GroupName="DateFilter" Content="All dates" TabIndex="68" IsChecked="{Binding Path=UseFileDateFilter, Converter={StaticResource ebc}, ConverterParameter=None}" Margin="0,0,5,0"/>
                                                <RadioButton GroupName="DateFilter" Content="Modified" TabIndex="69" IsChecked="{Binding Path=UseFileDateFilter, Converter={StaticResource ebc}, ConverterParameter=Modified}" Margin="0,0,5,0"/>
                                                <RadioButton GroupName="DateFilter" Content="Created" TabIndex="70" IsChecked="{Binding Path=UseFileDateFilter, Converter={StaticResource ebc}, ConverterParameter=Created}"/>
                                            </StackPanel>
                                            <Grid Grid.Row="2" Grid.Column="2" Grid.RowSpan="3">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*" />
                                                    <RowDefinition Height="3" />
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <RadioButton GroupName="TimeRange" Grid.Row="0" Grid.Column="0" Margin="0" Content="From" IsChecked="{Binding Path=TypeOfTimeRangeFilter, Converter={StaticResource ebc}, ConverterParameter=Dates}" IsEnabled="{Binding Path=IsDateFilterSet}" TabIndex="71" VerticalAlignment="Center" VerticalContentAlignment="Center"/>
                                                <DatePicker Grid.Row="0" Grid.Column="1" Width="128" TabIndex="72" ToolTip="from the start of the day" CalendarStyle="{StaticResource CalendarStyle}" DisplayDate="{x:Static sys:DateTime.Now}" DisplayDateStart="{Binding MinStartDate}" SelectedDate="{Binding StartDate}" IsEnabled="{Binding IsDatesRangeSet}" Height="Auto" Margin="5,0,0,0" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Row="2" Grid.Column="0" Margin="16,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Center" Text="To"/>
                                                <DatePicker Grid.Row="2" Grid.Column="1" Width="128" TabIndex="73" ToolTip="through the end of the day" CalendarStyle="{StaticResource CalendarStyle}" DisplayDateStart="{Binding MinEndDate}" DisplayDate="{x:Static sys:DateTime.Now}" SelectedDate="{Binding EndDate}" IsEnabled="{Binding IsDatesRangeSet}" Height="Auto" Margin="5,0,0,0" VerticalContentAlignment="Center" VerticalAlignment="Center"/>
                                            </Grid>
                                            <StackPanel Orientation="Horizontal" Margin="0,3,0,0" Grid.Row="6" Grid.Column="2">
                                                <RadioButton GroupName="TimeRange" VerticalAlignment="Center" Content="Past" IsChecked="{Binding Path=TypeOfTimeRangeFilter, Converter={StaticResource ebc}, ConverterParameter=Hours}" IsEnabled="{Binding Path=IsDateFilterSet}" TabIndex="74" VerticalContentAlignment="Center"/>
                                                <TextBox Width="48" IsEnabled="{Binding IsHoursRangeSet}" TabIndex="75" GotFocus="TextBoxFocus" PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBoxPasting" Text="{Binding HoursFrom, UpdateSourceTrigger=PropertyChanged}" Height="24" Margin="12,0,0,0" VerticalAlignment="Center" VerticalContentAlignment="Center"/>
                                                <TextBlock Text="to" VerticalAlignment="Center" TextAlignment="Center" Width="27"/>
                                                <TextBox Width="48" IsEnabled="{Binding IsHoursRangeSet}" TabIndex="76" GotFocus="TextBoxFocus" PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBoxPasting" Height="24" Margin="5,0,0,0" VerticalAlignment="Center" VerticalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="HoursTo" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <ExceptionValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <TextBlock VerticalAlignment="Center" Text="hours" Margin="5,0,0,0"/>
                                            </StackPanel>
                                            <StackPanel x:Name="MiddleFileOptions" Orientation="Vertical" Margin="15,3,0,3" VerticalAlignment="Bottom" Width="220" Grid.Column="2"/>
                                        </Grid>
                                    </StackPanel>
                                    <!-- right -->
                                    <StackPanel x:Name="stckRightSearchOptions" Orientation="Vertical" VerticalAlignment="Top" Margin="0">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="22" />
                                                <RowDefinition Height="3" />
                                                <RowDefinition Height="*" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="90"/>
                                                <ColumnDefinition/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Paths to match:" Foreground="Black" Margin="3" TextWrapping="NoWrap" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                                            <ComboBox x:Name="tbFilePattern" TabIndex="77" Text="{Binding FilePattern, UpdateSourceTrigger=PropertyChanged}" ItemsSource="{Binding FastFileMatchBookmarks}" GotFocus="TextBoxFocus" IsEditable="True" my:DiginesisHelpProvider.HelpKeyword="SearchReplace" my:DiginesisHelpProvider.HelpNavigator="Topic" my:DiginesisHelpProvider.ShowHelp="True" HorizontalContentAlignment="Stretch" Grid.Column="1" />
                                            <TextBlock Grid.Row="2"  Text="Paths to ignore:" Margin="3" Style="{StaticResource GrayedOutFilePattern}" TextWrapping="NoWrap" VerticalAlignment="Top" HorizontalAlignment="Left"/>
                                            <ComboBox Grid.Row="2" Grid.Column="1" Margin="3" x:Name="tbFilePatternIgnore" TabIndex="78"  VerticalAlignment="Top" Text="{Binding FilePatternIgnore, UpdateSourceTrigger=PropertyChanged}" ItemsSource="{Binding FastFileNotMatchBookmarks}" GotFocus="TextBoxFocus" IsEditable="True" my:DiginesisHelpProvider.HelpKeyword="SearchReplace" my:DiginesisHelpProvider.HelpNavigator="Topic" my:DiginesisHelpProvider.ShowHelp="True"/>
                                            <StackPanel  Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="2">
                                                <StackPanel Orientation="Horizontal">
                                                    <RadioButton GroupName="FileSearchType" x:Name="rbFileRegex" TabIndex="79" Content="Regex" IsChecked="{Binding TypeOfFileSearch, ConverterParameter=Regex, Converter={StaticResource ebc}}" ToolTip="e.g. file[0-9]{1,2}\\.txt" VerticalContentAlignment="Center" VerticalAlignment="Center" />
                                                    <RadioButton GroupName="FileSearchType" x:Name="rbFileAsterisk" TabIndex="80" Content="Asterisk pattern" IsChecked="{Binding TypeOfFileSearch, ConverterParameter=Asterisk, Converter={StaticResource ebc}}" ToolTip="e.g. file??.*" VerticalContentAlignment="Center" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <Button Content="Reset Search Options" Command="{Binding ResetOptionsCommand}" TabIndex="81" Height="22" Width="128" HorizontalAlignment="Right" Grid.Column="1" VerticalAlignment="Center" Grid.Row="8"/>
                                        </Grid>
                                    </StackPanel>
                                </DockPanel>
                            </GroupBox>
                        </Expander>
                    </StackPanel>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="5" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Left" Text="Search for:"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" Text="{Binding SearchFor}" IsEditable="True" x:Name="tbSearchFor" ItemsSource="{Binding FastSearchBookmarks}" Style="{DynamicResource MultilineComboBoxStyle}" IsTextSearchCaseSensitive="True" FontFamily="Consolas" FontSize="12" TabIndex="30" my:DiginesisHelpProvider.HelpKeyword="Regular-Expressions" my:DiginesisHelpProvider.HelpNavigator="Topic" my:DiginesisHelpProvider.ShowHelp="True" Padding="5" Margin="5,0,0,0" VerticalContentAlignment="Center" VerticalAlignment="Center">
                            <ComboBox.ToolTip>
                                <TextBlock><Run Text=". matches all characters"/><LineBreak/><Run Text="\w matches alpha-numerics"/><LineBreak/><Run Text="\d matches digits"/><LineBreak/><Run Text="\s matches space"/><LineBreak/><Run Text="* matches any number of characters"/><LineBreak/><Run Text="{}{1,3} matches 1 to 3 characters"/><LineBreak/><Run Text="For more Regex patterns hit F1"/></TextBlock>
                            </ComboBox.ToolTip>
                        </ComboBox>
                        <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Left" Text="Replace with:"/>
                        <ComboBox Grid.Row="2" Grid.Column="1" Text="{Binding ReplaceWith}" IsEditable="True" x:Name="tbReplaceWith" ItemsSource="{Binding FastReplaceBookmarks}" Style="{DynamicResource MultilineComboBoxStyle}"IsTextSearchCaseSensitive="True" FontFamily="Consolas" FontSize="12" TabIndex="40" Padding="5" Margin="5,0,0,0" VerticalContentAlignment="Center" VerticalAlignment="Center">
                            <ComboBox.ToolTip>
                                <TextBlock><Run Text="$&amp; replaces entire regex"/><LineBreak/><Run Text="$1, $2, $3, etc... inserts the text matched between capturing parentheses into the replacement text"/><LineBreak/><Run Text="$$ inserts a single dollar sign into the replacement text"/></TextBlock>
                            </ComboBox.ToolTip>
                        </ComboBox>
                    </Grid>
                </DockPanel>
            </GroupBox>
            <Grid DockPanel.Dock="Top" Margin="0,3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <WrapPanel Grid.Column="0" HorizontalAlignment="Right" Orientation="Horizontal" Margin="0,0,0,0">
                    <CheckBox Content="Search _in results" IsChecked="{Binding SearchInResultsContent}" Visibility="{Binding CanSearchInResults, Converter={StaticResource BoolToVisibilityConverter}}" VerticalAlignment="Center" TabIndex="90" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                    <CheckBox Content="Pre_view file" IsChecked="{Binding PreviewFileContent}" VerticalAlignment="Center" TabIndex="91" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                    <CheckBox Content="Stop after first match" IsChecked="{Binding StopAfterFirstMatch}" VerticalAlignment="Center" TabIndex="92" Margin="5,0" VerticalContentAlignment="Center"/>
                    <Button Content="_Search" Width="72" IsDefault="True" Command="{Binding SearchCommand}" TabIndex="93" Margin="5,0,0,0" VerticalAlignment="Center" Height="22"/>
                    <Button Content="Replace" Width="72" Command="{Binding ReplaceCommand}" TabIndex="94" VerticalAlignment="Center" Margin="5,0,0,0" Height="22"/>
                    <Button Content=">>" Width="32" Click="btnOtherActions_Click" ContextMenuService.Placement="Bottom" IsEnabled="{Binding CanSearchInResults}" TabIndex="95" Height="22" Margin="5,0,0,0" VerticalAlignment="Center">
                        <Button.ContextMenu>
                            <ContextMenu x:Name="advanceContextMenu">
                                <MenuItem Header="Copy files..." Command="{Binding CopyFilesCommand}"/>
                                <MenuItem Header="Move files..." Command="{Binding MoveFilesCommand}"/>
                                <MenuItem Header="Delete files..." Command="{Binding DeleteFilesCommand}"/>
                                <Separator/>
                                <MenuItem Header="Copy file names" Command="{Binding CopyToClipboardCommand}"/>
                                <MenuItem Header="Copy results" Command="{Binding CopyMatchingLinesCommand}"/>
                                <MenuItem Header="Save results..." Command="{Binding SaveResultsCommand}"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>
                    <Button Content="_Cancel" Width="72" Command="{Binding CancelCommand}" TabIndex="96" Height="22" Margin="5,0" VerticalAlignment="Center"/>
                </WrapPanel>
            </Grid>
            <Controls:ResultsTree DataContext="{Binding SearchResults}" TabIndex="100"/>
        </DockPanel>
    </DockPanel>
</Window>
