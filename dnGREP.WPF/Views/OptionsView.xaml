<my:ThemedWindow x:Class="dnGREP.WPF.OptionsView"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:my="clr-namespace:dnGREP.WPF"
                 Title="Options" ResizeMode="NoResize" 
                 Height="600" MinWidth="500" SizeToContent="Width"
                 Background="{DynamicResource Dialog.Background}"
                 Icon="/dnGREP;component/nGREP.ico" 
                 WindowStartupLocation="CenterOwner"
                 my:DiginesisHelpProvider.HelpKeyword="Options" 
                 my:DiginesisHelpProvider.HelpNavigator="Topic" 
                 my:DiginesisHelpProvider.ShowHelp="True" >
    <Window.Resources>
        <my:EnumBooleanConverter x:Key="ebc" />
        <my:InverseBooleanConverter x:Key="not"/>
        <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource LabelTextBlockStyle}"/>

        <Style TargetType="{x:Type GroupBox}" BasedOn="{StaticResource ThemedGroupBox}">
            <Setter Property="Margin" Value="0,12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type GroupBox}">
                        <Grid SnapsToDevicePixels="True">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="160"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Border x:Name="Header" Grid.Column="0" Padding="0" Margin="0,6,30,0">
                                <ContentPresenter ContentTemplate="{TemplateBinding HeaderTemplate}" 
                                                  Content="{TemplateBinding Header}" 
                                                  ContentStringFormat="{TemplateBinding HeaderStringFormat}" 
                                                  ContentSource="Header" 
                                                  HorizontalAlignment="Right"
                                                  RecognizesAccessKey="True" 
                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </Border>
                            <ContentPresenter Grid.Column="1" 
                                              ContentTemplate="{TemplateBinding ContentTemplate}" 
                                              Content="{TemplateBinding Content}" 
                                              ContentStringFormat="{TemplateBinding ContentStringFormat}" 
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>


    <Grid Margin="12,0,0,0">
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <ScrollViewer Grid.Row="0">
            <StackPanel  HorizontalAlignment="Stretch">
                
                <GroupBox Header="Startup options" ToolTip="{Binding Path=PanelTooltip}">
                    <StackPanel Orientation="Vertical">
                        <CheckBox Margin="0,6,0,3" 
                                  Content="Enable Windows Explorer integration"
                                  IsChecked="{Binding Path=EnableWindowsIntegration}" 
                                  ToolTip="{Binding Path=WindowsIntegrationTooltip}"
                                  IsEnabled="{Binding Path=IsAdministrator}" />
                        <CheckBox Margin="0,3" 
                                  Content="Enable startup accelerator"
                                  IsChecked="{Binding Path=EnableStartupAcceleration}" 
                                  ToolTip="{Binding Path=StartupAccelerationTooltip}"
                                  IsEnabled="{Binding Path=IsAdministrator}" />
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Checking for updates">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox Name="cbCheckForUpdates" 
                                  Content="Enable automatic checking every"
                                  IsChecked="{Binding Path=EnableCheckForUpdates}"/>
                        <TextBox Width="31" Height="24" Margin="3,0,0,0"
                                 IsEnabled="{Binding ElementName=cbCheckForUpdates, Path=IsChecked}" 
                                 Text="{Binding Path=CheckForUpdatesInterval, UpdateSourceTrigger=PropertyChanged}"/>
                        <Label Content="days" Margin="3,0" />
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Theme">
                    <StackPanel>
                        <CheckBox Margin="0,6,0,3" 
                                  Content="Follow Windows Theme"
                                  IsChecked="{Binding Path=FollowWindowsTheme}"
                                  IsEnabled="{Binding Path=HasWindowsThemes}"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Selected Theme" Margin="0,3"/>
                            <ComboBox Width="200" Margin="6,3"
                                      ItemsSource="{Binding Path=ThemeNames}" 
                                      SelectedValue="{Binding Path=CurrentTheme}"
                                      IsEnabled="{Binding Path=FollowWindowsTheme, Converter={StaticResource not}}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Custom editor">
                    <Grid Margin="0,0,12,0">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="440"/>
                            <ColumnDefinition Width="40"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Command" Margin="0,0,3,0"/>
                        <TextBox Grid.Column="1" Grid.Row="0" Height="24"
                                 Text="{Binding Path=CustomEditorPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,2,0,1" />
                        <Button Grid.Column="2" Margin="7,2,1,1" Height="24" Width="32"
                                Command="{Binding Path=BrowseCommand}">...</Button>
                        <TextBlock Grid.Column="0" Grid.Row="1" Text="Arguments" Margin="0,0,3,0"/>
                        <TextBox Grid.Column="1" Grid.Row="1" Margin="0,1" 
                                 Text="{Binding Path=CustomEditorArgs, UpdateSourceTrigger=PropertyChanged}" Height="24" />
                        <TextBlock Grid.Row="2" Grid.Column="1" TextWrapping="Wrap"   
                                   Text="Use %file and %line keywords for file location and line number and %pattern for search pattern"/>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Layout">
                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                        <TextBlock Text="Show search options:"/>
                        <RadioButton Content="on main panel" GroupName="searchLocation" Margin="18,0" 
                                     IsChecked="{Binding OptionsLocation, Converter={StaticResource ebc}, ConverterParameter=MainPanel}"/>
                        <RadioButton Content="in options expander" GroupName="searchLocation" Margin="3,0" 
                                     IsChecked="{Binding OptionsLocation, Converter={StaticResource ebc}, ConverterParameter=OptionsExpander}"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Results Options">
                    <StackPanel Margin="0,3,0,0">
                        <CheckBox Name="cbShowPath" Margin="3" Content="Show file path in results panel"
                                  IsChecked="{Binding Path=ShowFilePathInResults}"/>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox Name="cbShowContext" Margin="3" IsChecked="{Binding Path=ShowLinesInContext}" HorizontalAlignment="Center">Show result lines in context</CheckBox>
                            <TextBox Width="32" Text="{Binding Path=ContextLinesBefore, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding ElementName=cbShowContext, Path=IsChecked}" Height="24" Margin="3,0,0,0"></TextBox>
                            <Label Content="before and"/>
                            <TextBox Width="32" Text="{Binding Path=ContextLinesAfter, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding ElementName=cbShowContext, Path=IsChecked}" Height="24"/>
                            <Label Content="after"/>
                        </StackPanel>
                        
                        <CheckBox Margin="3" Name="cbSearchFileNameOnly" IsChecked="{Binding Path=AllowSearchWithEmptyPattern}">
                            <CheckBox.Content>
                                <TextBlock>Allow searching for file name pattern only when "search for" is empty</TextBlock>
                            </CheckBox.Content>
                        </CheckBox>
                        
                        <CheckBox Margin="3" Name="cbExpandResult" Content="Show results tree expanded"
                                  IsChecked="{Binding Path=AutoExpandSearchTree}"/>

                        <CheckBox Margin="3" Name="cbShowMatchVerbose" Content="Show verbose match count"
                                  IsChecked="{Binding Path=ShowVerboseMatchCount}"/>

                    </StackPanel>
                </GroupBox>

                <GroupBox Header="History Lists">
                    <StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <TextBox Text="{Binding MaxPathBookmarks, UpdateSourceTrigger=PropertyChanged}" Width="48" Margin="3,0" TextAlignment="Right"
                                 PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBox_Pasting" Height="24"/>
                            <TextBlock Text="items shown in path history list" Margin="3"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBox Text="{Binding MaxSearchBookmarks, UpdateSourceTrigger=PropertyChanged}" Width="48" Margin="3,0" TextAlignment="Right"
                                 PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBox_Pasting" Height="24"/>
                            <TextBlock Text="items shown in search and replace history lists" Margin="3"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBox Text="{Binding MaxExtensionBookmarks, UpdateSourceTrigger=PropertyChanged}" Width="48" Margin="3,0" TextAlignment="Right"
                                 PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBox_Pasting" Height="24"/>
                            <TextBlock Text="items shown in file filter history lists" Margin="3"/>
                        </StackPanel>
                        <Button Height="24" Name="btnClearPreviousSearches" Width="112" HorizontalAlignment="Left" Margin="3" Command="{Binding Path=ClearSearchesCommand}">Clear old searches</Button>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Regex Options">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.Resources>
                                <DataTemplate DataType="{x:Type ValidationError}">
                                    <TextBlock Foreground="Red" HorizontalAlignment="Right" Text="{Binding Path=ErrorContent}" Margin="4,8" />
                                </DataTemplate>
                            </StackPanel.Resources>
                            <TextBlock Text="Match timeout" Margin="0,0,3,0"/>
                            <TextBox Name="tbMatchTimeout" Width="48" Height="24" Margin="3,0"
                                     Text="{Binding Path=MatchTimeout, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}"
                                     Validation.ErrorTemplate="{x:Null}" />
                            <TextBlock Text="seconds" Margin="3,0,0,0"/>
                            <ContentPresenter Content="{Binding ElementName=tbMatchTimeout, Path=(Validation.Errors).CurrentItem}"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Width="440">The match timeout limits how long the regular expression engine will attempt to resolve a regular expression before it times out. This prevents processing expressions and input strings that require excessive backtracking.</TextBlock>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Phonetic Search">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.Resources>
                                <DataTemplate DataType="{x:Type ValidationError}">
                                    <TextBlock Foreground="Red" HorizontalAlignment="Right" Text="{Binding Path=ErrorContent}" Margin="4,6"/>
                                </DataTemplate>
                            </StackPanel.Resources>
                            <TextBlock Text="Match threshold (from 0 to 1.0)" Margin="0,0,6,0"/>
                            <TextBox Name="tbFuzzyMatchThreshold" Width="48" Height="24"
                                     Text="{Binding Path=MatchThreshold, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}"
                                     Validation.ErrorTemplate="{x:Null}"/>
                            <ContentPresenter Content="{Binding ElementName=tbFuzzyMatchThreshold, Path=(Validation.Errors).CurrentItem}"/>
                        </StackPanel>
                        <TextBlock Text="0 - match everything; 1.0 - exact match"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>

        </ScrollViewer>

        <WrapPanel Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,6,0,0">
            <Button Width="64" Margin="0,5,10,5" Height="24" IsDefault="True" Content="Save" Command="{Binding Path=SaveCommand}"/>
            <Button Width="64" Margin="0,5,15,5" Height="24" IsCancel="True" Content="Close"/>
        </WrapPanel>
    </Grid>
</my:ThemedWindow>
